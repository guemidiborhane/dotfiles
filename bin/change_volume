#!/bin/bash
# PATH: ~/.bin/change_volume

# This script is used to change the volume of the default sink
# It takes one argument, which is the percentage to change the volume by
# If the argument is negative, the volume will be decreased
# If the argument is positive, the volume will be increased
# If the argument is 0, the volume will be muted
# If the argument is 100, the volume will be unmuted
# Then show a notification with the volume bar

# Get the current volume
default_sink=$(pactl info | grep 'Default Sink' | awk '{print $3}')
# Show a notification with the volume bar
# Get the current volume
current_volume=$(pactl list sinks | grep -A15 "$default_sink" | grep 'Volume:' | grep -Eo '[0-9]+%' | head -n 1 | sed 's/%//g')
mute_status=$(pactl list sinks | grep -A15 "$default_sink" | grep 'Mute:' | awk '{print $2}')

# Get the argument
change="$1"

# Change the volume
if [[ "$change" -eq "toggle-mute" ]]; then
    pactl set-sink-mute "$default_sink" toggle
    if [[ "$mute_status" == "yes" ]]; then
        icon="up"
    else
        icon="mute"
        current_volume=0
    fi
elif [[ "$change" -gt 0 ]]; then
    pactl set-sink-volume "$default_sink" "$((current_volume+change))%"
    icon="up"
else
    pactl set-sink-volume "$default_sink" "$((current_volume+change))%"
    icon="down"
fi

# Show the notification
notify-send \
    -i "~/.script-icons/volume-$icon.png" \
    -h int:value:"$current_volume" \
    -h string:synchronous:"volume" \
    "Volume" \
    "$current_volume%"
