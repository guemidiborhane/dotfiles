#!/bin/sh
# vim: set ft=sh sw=4 et :

INSTALL_ALL=no

package_files_dir="$HOME/.config/yadm/packages/*.list"

enabled_user_services=(
    pi-hole
    wallpaper.timer
    run-mount-scripts.timer
)

enabled_system_services=(
    fstrim.timer
    ntpd.service
    bluetooth.service
)

# Source all scripts in .config/yadm/scripts
for script in $HOME/.config/yadm/scripts/*.sh; do
    if [ -f "$script" ]; then
        echo "Sourcing $script"
        . $script
    fi
done

# check if RUN_ALL environment variable is set
# and if it's set to "yes" run all scripts
if [[ $RUN_ALL = "yes" ]]; then
    INSTALL_ALL=yes
fi

if [[ $INSTALL_ALL = "no" ]]; then
    read -p "Run all scripts? [y/N] " -n 1 -r
    echo   # (optional) move to a new line
    if [[ $REPLY =~ ^[Yy]$ ]]
    then
        INSTALL_ALL=yes
    fi
fi

main () {
    echo "Bootstrapping"
    yadm alt

    # scripts/opendoas.sh
    opendoas_main

    # scripts/misc.sh
    clean_slate
    install_packages "$package_files_dir"

    # scripts/vim.sh
    vim_main

    # scripts/zsh.sh
    zsh_main

    # scripts/system.sh
    enable_system_services "${enabled_system_services[@]}"

    # scripts/misc.sh
    enable_user_services "${enabled_user_services[@]}"

    # scripts/system.sh
    configure_resolvconf

    # scripts/misc.sh
    configure_docker
}

main
